<!doctype html>
<html>
<head>
  <title>TNNT::{{ player.name }}</title>
  {% include "headlinks.html" %}
</head>

<body>

{% include "header.html" with page='players' %}

<h1>{{ player.name }}</h1>

<div class="row">

<!-- === GENERAL INFORMATION ============================================== -->

<table>
  <thead>
    <tr class="framed"><th colspan=2>general information</th></tr>
  </thead>
  {% if player.clan %}
    <tr>
      <td>clan</td>
      <td class="num">{% include "clink.html" with clan=player.clan.name %}</td>
    </tr>
  {% endif %}
  <tr>
    <td>total games</td>
    <td class="num">{{ player.total_games }}</td>
  </tr>
  <tr>
    <td>games ascended</td>
    <td class="num">{{ player.wins }}</td>
  </tr>
  <tr>
    <td>games over 1000 turns</td>
    <td class="num">{{ player.games_over_1000_turns }}</td>
  </tr>
  <tr>
    <td>games scummed</td>
    <td class="num">{{ player.games_scummed }}</td>
  </tr>
  <tr>
    <td>ascension ratio</td>
    <td class="num">{{ player.ratio }}</td>
  </tr>
  <tr>
    <td>distinct achievements</td>
    <td class="num">{{ player.unique_achievements }}</td>
  </tr>

</table>

<!-- == TROPHIES ========================================================== -->

<table>
  <thead>
    <tr class="framed"><th colspan="2">trophies</th></tr>
  </thead>
  <tbody>
    {% for tr in player.trophies.all %}
      <tr>
        <td>{{ tr.name }}</td>
        <!-- TODO: show when a trophy was attained (stretch goal) -->
      </tr>
    {% endfor %}
  </tbody>
</table>
</div> <!-- class="row" -->

<!-- TODO: possibly show leaderboard ranks (stretch goal, not necessary for 2021) -->

<!-- == ASCENSIONS & RECENT GAMES ========================================= -->

{% if player.total_games > 0 %}
  {% if player.wins > 0 %}
    <h2>ASCENSIONS</h2>
    <table>
      <thead>
        <!-- TODO: old backend had this as a template, likely move the whole
             table? to a template -->
        <!-- [% INCLUDE game.tt head=1 aswon=1 class="framed" %] -->
        <tr class="won framed">
          <!-- there used to be a counter td here, which has been removed -->
          <th>name</th>
          <th>character</th>
          <th>turns</th>
          <th>score</th>
          <th>duration</th>
          <th>endtime</th>
          <th colspan=2>conducts</th>
        </tr>
      </thead>
      <tbody>
        {% for game in ascensions %}
          {% include "gamerow.html" with ascview=True %}
        {% endfor %}
      </tbody>
    </table>
  {% endif %} <!-- wins > 0 -->
  <h2>RECENT GAMES</h2>
  <table>
    <thead>
      <tr class="framed">
        <th>name</th>
        <th>character</th>
        <th>turns</th>
        <th>score</th>
        <th>duration</th>
        <th>endtime</th>
        <th colspan=2>death reason</th>
      </tr>
    </thead>
    <tbody>
      {% for game in recentgames %}
        {% include "gamerow.html" with ascview=False %}
      {% endfor %}
    </tbody>
  </table>
{% endif %} <!-- games > 0 -->

<!-- == STREAKS =========================================================== -->

{% if player.longest_streak > 0 %}
  <h2>STREAKS</h2>
  <table>
    <thead>
      <tr class="framed">
        <th>&nbsp;</th>
        <th>len</th>
        <th>start</th>
        <th>end</th>
        <th>continuable</th>
        <th>streak games</th>
      </tr>
    </thead>
    <tbody>
      {% with streaks=player.get_streaks %}
        {% for streak in streaks %}
          <tr>
            <td class="num dim">{{ forloop.counter }}</td>
            <td class="num">{{ streak.games | length }}</td>
            <td class="num">{{ streak.games.0.starttime }}</td>
            <td class="num">
              <!-- annoying construction -->
              {% with lastgame=streak.games|last %}{{ lastgame.endtime }}{% endwith %}
            </td>
            <td class="num streak-continuable">
              {% if streak.continuable %} &check; {% else %} &cross; {% endif %}
            </td>
            <td>
              {% for g in streak.games %}
                <span class="streak">
                  <a href="{{ g.get_dumplog }}">{{ g.rrga }}</a>
                </span>
              {% endfor %}
            </td>
          </tr>
        {% endfor %}
      {% endwith %}
    </tbody>
  </table>
{% endif %}

<!-- == ACHIEVEMENTS ====================================================== -->

<h2 id="achievements">Achievements</h2>
<div class="achieve-top">
  <table>
    <thead>
      <tr class="framed">
        <th></th>
        <th>Achievement</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      {% for ach in achievements %}
        <tr>
          {% if ach.obtained %}
            <td class="achieved">&check;</td>
          {% else %}
            <td class="not-achieved">&cross;</td>
          {% endif %}
          <td>{{ ach.name }}</td>
          <td>{{ ach.description }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
  <!-- TODO: Make this a template so that singleclan can use it too? Actually,
    how about most of the whole page? -->
  <div class="achieve-summary">
    {% with plr_ach=player.unique_achievements tot_ach=achievements.count %}
      <div class="achieve-bar"
          style="width:{% widthratio plr_ach tot_ach 100 %}%"></div>
      <div class="achieve-msg">
        {{ plr_ach }} out of {{ tot_ach }} achievements attained
      </div>
    {% endwith %}
  </div>
</div>

</body>
</html>
